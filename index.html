function getLocation() {
    // Cek apakah browser mendukung Geolocation
    if (!navigator.geolocation) {
        return Swal.fire('Error', 'Browser Anda tidak mendukung GPS.', 'error');
    }

    document.getElementById('gpsStatus').innerText = "⌛ Menghubungkan Satelit...";
    
    // Opsi akurasi tinggi
    const options = {
        enableHighAccuracy: true,
        timeout: 10000, // Menunggu maksimal 10 detik
        maximumAge: 0
    };

    navigator.geolocation.getCurrentPosition(
        (pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            userLocation = { lat, lon };
            
            // Hitung Jarak
            const km = calculateDistance(TOKO_LOKASI.lat, TOKO_LOKASI.lon, lat, lon);
            
            // Hitung Ongkir
            finalOngkir = Math.max(ONGKIR_MIN, Math.ceil(km) * BIAYA_PER_KM);
            
            document.getElementById('gpsStatus').innerText = "✅ LOKASI TERKUNCI";
            document.getElementById('distanceText').innerText = `Jarak: ${km.toFixed(2)} KM dari Toko`;
            
            renderCart();
            Swal.fire({
                title: 'Lokasi Ditemukan!',
                text: `Jarak ke toko sekitar ${km.toFixed(2)} KM. Ongkir otomatis terhitung.`,
                icon: 'success',
                confirmButtonColor: '#8B1A1A'
            });
        },
        (err) => {
            document.getElementById('gpsStatus').innerText = "❌ GAGAL DETEKSI LOKASI";
            
            let pesanError = "Pastikan GPS aktif dan izin lokasi diberikan.";
            if (err.code === 1) pesanError = "Anda menolak izin lokasi. Silakan aktifkan di pengaturan browser.";
            if (err.code === 3) pesanError = "Waktu pencarian habis (Sinyal Lemah).";

            Swal.fire({
                title: 'Gagal Deteksi',
                html: `${pesanError}<br><br><small>Tips: Jika di dalam ruangan, coba mendekat ke jendela atau gunakan koneksi data seluler.</small>`,
                icon: 'error',
                confirmButtonText: 'Coba Lagi'
            });
        },
        options
    );
}
