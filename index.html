<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Lesehan Macca - Menu Lengkap</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root {
            --primary-red: #8B1A1A; 
            --primary-grad: linear-gradient(135deg, #8B1A1A 0%, #B20610 100%);
            --bg: #f8f9fa;
            --card: #ffffff;
            --text-dark: #2d3436;
            --radius: 20px;
            --accent-grad: linear-gradient(135deg, #43E97B 0%, #38F9D7 100%);
        }
        .swal2-container { z-index: 9999 !important; }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text-dark); padding-bottom: 140px; }
        header { background-color: var(--primary-red); background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1555939594-58d7cb561ad1?auto=format&fit=crop&w=500'); background-size: cover; background-position: center; padding: 30px 20px; text-align: center; border-bottom: 5px solid #FFD700; }
        .main-logo-text { color: white; font-size: 32px; font-weight: 800; margin: 0; letter-spacing: -1px; font-style: italic; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        
        /* Profile Bar */
        .profile-bar { background: #fff; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; font-size: 13px; }
        .user-info { display: flex; align-items: center; gap: 8px; font-weight: 700; color: #444; }
        .btn-edit-profile { background: #f0f0f0; border: none; padding: 5px 10px; border-radius: 8px; font-size: 11px; font-weight: 700; cursor: pointer; color: var(--primary-red); }

        .tabs-container { position: sticky; top: 0; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px); z-index: 100; padding: 12px 0; display: flex; gap: 8px; overflow-x: auto; padding-left: 15px; border-bottom: 1px solid #eee; scrollbar-width: none; }
        .tabs-container::-webkit-scrollbar { display: none; }
        .tab-link { white-space: nowrap; padding: 10px 20px; background: #fff; border: 1px solid #eee; border-radius: 50px; font-weight: 700; color: #636e72; cursor: pointer; font-size: 13px; transition: 0.3s; }
        .tab-link.active { background: var(--primary-red); color: white; border-color: transparent; box-shadow: 0 5px 12px rgba(139, 26, 26, 0.2); }
        
        .container { max-width: 600px; margin: 0 auto; padding: 10px 15px; }
        .menu-section { display: none; }
        .menu-section.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        
        .section-title { font-size: 16px; font-weight: 800; color: var(--primary-red); margin: 20px 0 10px; border-left: 4px solid var(--primary-red); padding-left: 10px; }
        .menu-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        .menu-card { background: var(--card); border-radius: var(--radius); overflow: hidden; display: flex; align-items: center; padding: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.02); border: 1px solid #f0f0f0; }
        .product-img { width: 85px; height: 85px; border-radius: 12px; object-fit: cover; background: #f5f5f5; flex-shrink: 0; }
        .menu-info { flex: 1; padding: 0 12px; }
        .menu-info h4 { margin: 0 0 4px; font-size: 14px; font-weight: 700; color: #333; line-height: 1.3; }
        .menu-info p { margin: 0; font-size: 15px; color: var(--primary-red); font-weight: 800; }
        .add-btn { background: var(--primary-grad); color: white; border: none; width: 36px; height: 36px; border-radius: 12px; font-size: 20px; font-weight: bold; cursor: pointer; }
        
        .cart-bar { position: fixed; bottom: 20px; left: 50%; width: 92%; max-width: 500px; transform: translate(-50%, 150%); background: #1a1a1a; border-radius: 20px; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; color: white; z-index: 1000; transition: 0.4s; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .cart-bar.active { transform: translate(-50%, 0); }
        .checkout-btn { background: var(--primary-grad); color: white; border: none; padding: 12px 20px; border-radius: 12px; font-weight: 800; cursor: pointer; }
        
        .popup { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: none; z-index: 2000; align-items: flex-end; backdrop-filter: blur(4px); }
        .popup-content { background: #fff; width: 100%; max-width: 500px; margin: 0 auto; border-radius: 30px 30px 0 0; padding: 25px; max-height: 92vh; overflow-y: auto; }
        
        input, textarea { width: 100%; padding: 14px; border: 2px solid #f1f1f1; border-radius: 15px; margin-bottom: 12px; font-family: inherit; outline: none; }
        label { font-size: 11px; font-weight: 800; color: #888; text-transform: uppercase; margin-bottom: 8px; display: block; }
        
        .pay-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .pay-btn { flex: 1; padding: 14px; border: 2px solid #f1f1f1; border-radius: 15px; background: #fff; cursor: pointer; font-weight: 700; color: #666; }
        .pay-btn.selected { background: #fff5f5; border-color: var(--primary-red); color: var(--primary-red); }
        
        .btn-selesai { width: 100%; background: var(--accent-grad); color: #1d3924; border: none; padding: 18px; border-radius: 15px; font-weight: 800; cursor: pointer; font-size: 16px; margin-bottom: 10px; }
        .btn-batal-order { width: 100%; background: #f1f1f1; color: #888; border: none; padding: 14px; border-radius: 15px; font-weight: 700; cursor: pointer; }
        
        .qty-control { display: flex; align-items: center; gap: 12px; background: #f1f1f1; padding: 6px 12px; border-radius: 25px; }
        .qty-btn { background: none; border: none; color: var(--primary-red); font-weight: 800; font-size: 18px; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <h1 class="main-logo-text">Lesehan Macca</h1>
    <p>Lezat ‚Ä¢ Cepat ‚Ä¢ Bersahabat</p>
</header>

<div class="profile-bar" id="profileBar">
    <div class="user-info">
        <span>üëã</span>
        <span id="displayUserName">Halo, Pelanggan!</span>
    </div>
    <button class="btn-edit-profile" onclick="promptUserProfile()">Edit Profil</button>
</div>

<div class="tabs-container">
    <button class="tab-link active" onclick="openTab(event, 'paket')">‚≠ê Paket Hemat</button>
    <button class="tab-link" onclick="openTab(event, 'ayam')">üçó Ayam</button>
    <button class="tab-link" onclick="openTab(event, 'ikan')">üêü Ikan</button>
    <button class="tab-link" onclick="openTab(event, 'seafood')">üç§ Seafood</button>
    <button class="tab-link" onclick="openTab(event, 'nasimie')">üçö Nasi/Mie</button>
    <button class="tab-link" onclick="openTab(event, 'lauk')">ü•¨ Sayur</button>
</div>

<div class="container" id="menu-container"></div>

<div class="cart-bar" id="cartBar">
    <div>
        <span id="itemCount" style="font-weight:800; background:#333; padding:4px 10px; border-radius:8px; margin-right:8px;">0</span>
        <strong id="totalText">Rp 0</strong>
    </div>
    <button class="checkout-btn" onclick="openPopup()">Pesan Sekarang</button>
</div>

<div class="popup" id="popup">
    <div class="popup-content">
        <h3 style="margin-top:0; font-size:20px; color:var(--primary-red); font-weight:800;">Pesanan ini mau dikirim kemana?</h3>
        
        <textarea id="alamat" rows="3" placeholder="Contoh: Jl. Poros No. 12, Samping Masjid (Pagar Merah)"></textarea>

        <label>Metode Pembayaran</label>
        <div class="pay-group">
            <button class="pay-btn selected" id="btn-cod" onclick="setPayment('COD')">COD</button>
            <button class="pay-btn" id="btn-tf" onclick="setPayment('Transfer Bank')">TRANSFER / QRIS</button>
        </div>

        <label>Ringkasan Pesanan</label>
        <div id="cartList" style="max-height: 150px; overflow-y: auto; margin-bottom:15px; background: #fdfdfd; padding: 10px; border-radius: 12px; border: 1px solid #eee;"></div>

        <div style="background: #fff9f9; border-radius: 15px; padding: 15px; margin-bottom: 20px; border: 1px dashed #ffcccc;">
            <div style="display:flex; justify-content:space-between; font-size:13px; color:#666; margin-bottom:5px;">
                <span>Subtotal</span><span id="subtotalText">Rp 0</span>
            </div>
            <div style="display:flex; justify-content:space-between; font-size:13px; color:#666; margin-bottom:10px;">
                <span>Ongkir (Kurir Macca)</span><span>Rp 5.000</span>
            </div>
            <div style="display:flex; justify-content:space-between; border-top:1px solid #eee; padding-top:10px; font-weight:800; font-size:18px; color:var(--primary-red);">
                <span>Total Bayar</span><span id="popupTotal">Rp 0</span>
            </div>
        </div>

        <button id="btnFinal" class="btn-selesai" onclick="prosesPesanan()">KIRIM PESANAN</button>
        <button class="btn-batal-order" onclick="closePopup()">KEMBALI KE MENU</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBjEI1iiOjfrpyaZzEntRCGuiiorgxol0",
        databaseURL: "https://lesehan-macca-new-default-rtdb.asia-southeast1.firebasedatabase.app"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const menuData = {
        paket: { title: "Paket Macca Hemat", items: [
            { name: "P.H Ayam Bakar + Es Teh", price: 22000, img: "https://images.unsplash.com/photo-1626074353765-517a681e40be?w=200" },
            { name: "P.H Bandeng Bakar + Es Teh", price: 20000, img: "https://thumb.viva.id/vivacianjur/1265x711/2025/01/22/679010470f3f5-bandeng-bakar_cianjur.jpg?w=200" },
            { name: "P.H Lele Goreng + Es Teh", price: 18000, img: "https://images.unsplash.com/photo-1599481238640-4c1288750d7a?w=200" }
        ]},
        ayam: { title: "Olahan Ayam", items: [
            { name: "Ayam Bakar Rica/Biasa", price: 14000, img: "https://images.unsplash.com/photo-1598515214211-89d3c73ae83b?w=200" },
            { name: "Ayam Goreng Krispi", price: 13000, img: "https://images.unsplash.com/photo-1562967914-608f82629710?w=200" }
        ]},
        ikan: { title: "Olahan Ikan", items: [
            { name: "Bandeng Bakar Jumbo", price: 25000, img: "https://images.unsplash.com/photo-1519708227418-c8fd9a32b7a2?w=200" },
            { name: "Lele Bakar Rica", price: 12000, img: "https://images.unsplash.com/photo-1599481238640-4c1288750d7a?w=200" }
        ]},
        seafood: { title: "Menu Seafood", items: [
            { name: "Udang Saos Padang", price: 35000, img: "https://images.unsplash.com/photo-1559181567-c3190ca9959b?w=200" },
            { name: "Cumi Goreng Tepung", price: 30000, img: "https://images.unsplash.com/photo-1590594460041-996453cf1375?w=200" }
        ]},
        nasimie: { title: "Nasi & Mie", items: [
            { name: "Nasi Goreng Spesial", price: 15000, img: "https://images.unsplash.com/photo-1512058560566-42724afbc2db?w=200" },
            { name: "Mie Goreng Jawa", price: 15000, img: "https://images.unsplash.com/photo-1585032226651-759b368d7246?w=200" }
        ]},
        lauk: { title: "Sayur & Lauk", items: [
            { name: "Cah Kangkung", price: 10000, img: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=200" },
            { name: "Tahu Tempe Goreng", price: 5000, img: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=200" }
        ]}
    };

    let cart = [];
    let selectedPayment = "COD";
    let isProcessing = false;

    // LOGIN & PROFILE SYSTEM
    function checkProfile() {
        const savedUser = JSON.parse(localStorage.getItem('macca_user'));
        if (savedUser) {
            document.getElementById('displayUserName').innerText = `Halo, ${savedUser.nama}!`;
            return true;
        }
        return false;
    }

    function promptUserProfile() {
        const savedUser = JSON.parse(localStorage.getItem('macca_user')) || { nama: '', telp: '' };
        Swal.fire({
            title: 'Profil Pelanggan',
            html: `
                <input id="swal-nama" class="swal2-input" placeholder="Nama Anda" value="${savedUser.nama}">
                <input id="swal-telp" class="swal2-input" placeholder="No WhatsApp" value="${savedUser.telp}">
            `,
            confirmButtonText: 'Simpan Profil',
            confirmButtonColor: '#8B1A1A',
            preConfirm: () => {
                const nama = document.getElementById('swal-nama').value;
                const telp = document.getElementById('swal-telp').value;
                if (!nama || !telp) {
                    Swal.showValidationMessage('Nama dan WA wajib diisi!');
                }
                return { nama, telp };
            }
        }).then((result) => {
            if (result.isConfirmed) {
                localStorage.setItem('macca_user', JSON.stringify(result.value));
                checkProfile();
                Swal.fire('Tersimpan!', 'Profil Anda berhasil diperbarui.', 'success');
            }
        });
    }

    function initMenu() {
        checkProfile();
        const container = document.getElementById('menu-container');
        container.innerHTML = "";
        for (const key in menuData) {
            let html = `
                <div id="${key}" class="menu-section ${key === 'paket' ? 'active' : ''}">
                    <div class="section-title"><span>${menuData[key].title}</span></div>
                    <div class="menu-grid">
            `;
            menuData[key].items.forEach(item => {
                html += `
                    <div class="menu-card">
                        <img src="${item.img}" class="product-img">
                        <div class="menu-info">
                            <h4>${item.name}</h4>
                            <p>Rp ${item.price.toLocaleString()}</p>
                        </div>
                        <button class="add-btn" onclick="addItem('${item.name}', ${item.price})">+</button>
                    </div>
                `;
            });
            container.innerHTML += html + `</div></div>`;
        }
    }

    function openTab(e, id) {
        document.querySelectorAll(".menu-section").forEach(s => s.classList.remove("active"));
        document.querySelectorAll(".tab-link").forEach(t => t.classList.remove("active"));
        document.getElementById(id).classList.add("active");
        e.currentTarget.classList.add("active");
    }

    function addItem(name, price) {
        cart.push({name, price});
        updateUI();
        if(document.getElementById('popup').style.display === 'flex') renderCart();
    }

    function removeItem(name) {
        const index = cart.findIndex(item => item.name === name);
        if (index > -1) {
            cart.splice(index, 1);
            updateUI();
            renderCart();
        }
    }

    function updateUI() {
        const total = cart.reduce((sum, item) => sum + item.price, 0);
        const bar = document.getElementById('cartBar');
        if (cart.length > 0) bar.classList.add('active');
        else bar.classList.remove('active');
        document.getElementById('totalText').innerText = `Rp ${total.toLocaleString()}`;
        document.getElementById('itemCount').innerText = cart.length;
    }

    function setPayment(val) {
        const currentTotal = document.getElementById('popupTotal').innerText;
        if (val === 'Transfer Bank') {
            Swal.fire({
                title: 'Info Pembayaran',
                html: `
                    <div style="text-align: center;">
                        <h2 style="color:#8B1A1A;">${currentTotal}</h2>
                        <p><strong>BANK BRI</strong><br>0403 0101 2546 539<br>A/N SULKIFLI</p>
                        <img src="https://i.ibb.co.com/mC8SDk1j/Whats-App-Image-2026-01-01-at-16-20-37.jpg" style="width: 200px; border-radius: 10px;">
                    </div>
                `,
                confirmButtonText: 'Oke',
                confirmButtonColor: '#8B1A1A',
            });
            selectedPayment = 'Transfer Bank';
            document.getElementById('btn-cod').classList.remove('selected');
            document.getElementById('btn-tf').classList.add('selected');
        } else {
            selectedPayment = 'COD';
            document.getElementById('btn-cod').classList.add('selected');
            document.getElementById('btn-tf').classList.remove('selected');
        }
    }

    function openPopup() {
        if (!checkProfile()) {
            return promptUserProfile();
        }
        if(cart.length === 0) return;
        renderCart();
        document.getElementById('popup').style.display = 'flex';
    }

    function closePopup() {
        document.getElementById('popup').style.display = 'none';
    }

    function renderCart() {
        const list = document.getElementById('cartList');
        list.innerHTML = '';
        let subtotal = 0;
        const summary = {};
        cart.forEach(item => {
            summary[item.name] = summary[item.name] || { price: item.price, qty: 0 };
            summary[item.name].qty++;
            subtotal += item.price;
        });

        for (const name in summary) {
            list.innerHTML += `
                <div style="display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid #f5f5f5;">
                    <div style="font-size:13px; font-weight:600; flex:1;">${name}</div>
                    <div class="qty-control">
                        <button class="qty-btn" onclick="removeItem('${name}')">‚àí</button>
                        <span style="font-weight:700;">${summary[name].qty}</span>
                        <button class="qty-btn" onclick="addItem('${name}', ${summary[name].price})">+</button>
                    </div>
                </div>
            `;
        }
        document.getElementById('subtotalText').innerText = `Rp ${subtotal.toLocaleString()}`;
        document.getElementById('popupTotal').innerText = `Rp ${(subtotal + 5000).toLocaleString()}`;
    }

    async function prosesPesanan() {
        if (isProcessing) return;
        
        const user = JSON.parse(localStorage.getItem('macca_user'));
        const a = document.getElementById('alamat').value.trim();
        const btn = document.getElementById('btnFinal');

        if(!a) return Swal.fire('Alamat Kosong!', 'Mohon isi alamat pengiriman.', 'warning');
        
        isProcessing = true;
        btn.disabled = true;
        btn.innerText = "MENGIRIM...";

        const sum = {}; cart.forEach(x => { sum[x.name] = (sum[x.name] || 0) + 1; });
        let detailOrder = ""; for(let k in sum) detailOrder += `${k} (x${sum[k]})\n`;

        const orderData = {
            customer: user.nama, 
            whatsapp: user.telp, 
            alamat: a, 
            pembayaran: selectedPayment,
            items: detailOrder.trim(),
            total: document.getElementById('popupTotal').innerText,
            status: 'new', 
            timestamp: firebase.database.ServerValue.TIMESTAMP
        };

        db.ref('orders').push(orderData).then(() => {
            Swal.fire('Berhasil!', 'Pesanan sedang diproses.', 'success').then(() => {
                location.reload();
            });
        }).catch(() => {
            isProcessing = false;
            btn.disabled = false;
            btn.innerText = "KIRIM PESANAN";
        });
    }

    window.onload = initMenu;
</script>

</body>
</html>
